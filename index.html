<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SkyNexaHost</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#00ffea;
      --bg:#0a0a0a;
      --glass:rgba(255,255,255,0.06);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Poppins',sans-serif;background:var(--bg);color:#fff}

    /* ===== LOADING ===== */
    #loadingScreen{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:2000;background:linear-gradient(135deg,#1e3c72,#2a5298)}
    .loading-logo{font-size:44px;font-weight:700;letter-spacing:.5px;background:linear-gradient(90deg,red,orange,yellow,green,cyan,blue,violet);-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:glow 2s ease-in-out infinite alternate}
    @keyframes glow{from{text-shadow:0 0 6px #fff}to{text-shadow:0 0 24px #fff,0 0 48px #0ff}}
    .loading-bar{width:240px;height:10px;border-radius:999px;background:rgba(255,255,255,0.2);overflow:hidden;margin-top:18px}
    .loading-fill{height:100%;width:0;background:linear-gradient(90deg,#00ffea,#00aaff);animation:fill 4s forwards}
    @keyframes fill{to{width:100%}}

    /* ===== SHARED BUTTONS ===== */
    button{background:#111;border:2px solid var(--brand);color:var(--brand);padding:10px 20px;border-radius:12px;cursor:pointer;transition:transform .25s ease, box-shadow .25s ease, filter .25s ease}
    button:hover{transform:translateY(-2px) scale(1.06);box-shadow:0 8px 24px rgba(0,0,0,.4),0 0 18px rgba(0,255,234,.35);filter:saturate(1.2)}
    .rainbow:hover{background:linear-gradient(90deg,red,orange,yellow,green,cyan,blue,violet);color:#111;border-color:transparent}

    /* ===== SCREENS ===== */
    #auth,#dashboard,#workspace,#previewArea{display:none}

    /* ===== AUTH ===== */
    #auth{min-height:100vh;display:flex;align-items:center;justify-content:center;background:radial-gradient(60% 60% at 50% 20%, rgba(0,255,234,.15), transparent 70%), radial-gradient(40% 40% at 10% 90%, rgba(0,140,255,.18), transparent 70%)}
    #authCard{background:var(--glass);backdrop-filter:blur(10px);padding:28px;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.45);width:min(520px,92vw)}
    #authCard h2{margin:0 0 12px;color:var(--brand)}
    .field{display:flex;gap:10px;margin:10px 0}
    .field input{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0f0f10;color:#fff}
    .uploader{display:flex;align-items:center;gap:12px;background:#0f0f10;border:1px dashed rgba(255,255,255,.18);padding:10px;border-radius:12px}
    .avatar-preview{width:56px;height:56px;border-radius:50%;background:#1b1b1b;display:grid;place-items:center;overflow:hidden;border:2px solid rgba(255,255,255,.1)}
    .avatar-preview img{width:100%;height:100%;object-fit:cover}
    .auth-actions{display:flex;gap:10px;justify-content:space-between;margin-top:12px}
    .auth-actions button{flex:1}

    /* ===== DASHBOARD ===== */
    #dashboard{padding:22px 16px 28px;position:relative}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{font-weight:700;font-size:20px;letter-spacing:.3px}
    #logoutBtn{font-size:12px;padding:6px 12px;border-radius:10px}

    .profile-chip{display:flex;align-items:center;gap:10px;background:var(--glass);padding:8px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);cursor:pointer;transition:all .25s}
    .profile-chip:hover{box-shadow:0 8px 24px rgba(0,0,0,.35)}
    .chip-avatar{width:36px;height:36px;border-radius:50%;overflow:hidden;border:2px solid rgba(255,255,255,.12);flex:0 0 auto}
    .chip-avatar img{width:100%;height:100%;object-fit:cover}
    .chip-name{font-weight:600}

    .dash-main{max-width:980px;margin:28px auto 0;text-align:center}
    #newProjectBtn{margin:18px auto 10px;display:block}
    #projects{margin-top:20px;display:flex;flex-wrap:wrap;justify-content:center;gap:18px}
    .project-box{background:var(--glass);padding:18px;border-radius:14px;width:220px;cursor:pointer;transition:.25s;border:1px solid rgba(255,255,255,.12)}
    .project-box:hover{transform:translateY(-4px) scale(1.04);background:rgba(255,255,255,.09)}

    /* ===== WORKSPACE ===== */
    #workspace{height:100vh;display:flex}
    #sidebar{width:220px;background:var(--glass);padding:12px;border-right:1px solid rgba(255,255,255,.1)}
    #fileList{list-style:none;margin:10px 0 0;padding:0}
    #fileList li{padding:8px 10px;border-radius:10px;cursor:pointer;transition:.2s}
    #fileList li:hover{background:rgba(255,255,255,.08)}
    #editorArea{flex:1;display:flex;flex-direction:column}
    #editorToolbar{display:flex;gap:8px;justify-content:flex-end;padding:10px;border-bottom:1px solid rgba(255,255,255,.08);background:linear-gradient( to right, rgba(0,255,234,.07), transparent)}
    #editor{flex:1;display:none}
    #noFileMsg{flex:1;display:flex;align-items:center;justify-content:center;color:#bdbdbd;font-size:18px;font-style:italic}

    /* ===== PREVIEW ===== */
    #previewArea{position:fixed;inset:0;background:#000;display:none;z-index:1500}
    #previewFrame{width:100%;height:100%;border:none}
    #closePreviewBtn{position:absolute;top:12px;right:12px}

    /* ===== PROFILE MODAL ===== */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:1600}
    .modal-card{width:min(560px,92vw);background:#0f0f10;border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:18px}
    .modal-actions{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}
    .row{display:flex;gap:10px}
    .row .field{flex:1}
    textarea{width:100%;min-height:90px;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0f0f10;color:#fff;resize:vertical}
  </style>
</head>
<body>

  <!-- LOADING -->
  <div id="loadingScreen">
    <div class="loading-logo">SkyNexaHost</div>
    <div class="loading-bar"><div class="loading-fill"></div></div>
  </div>

  <!-- AUTH -->
  <div id="auth">
    <div id="authCard">
      <h2>Welcome to SkyNexaHost</h2>
      <div class="field"><input type="text" id="username" placeholder="Username (required)"></div>
      <div class="field"><input type="password" id="password" placeholder="Password (required)"></div>
      <div class="uploader">
        <div class="avatar-preview" id="authAvatarPreview"><span style="font-size:12px;color:#aaa">Avatar</span></div>
        <div style="text-align:left">
          <div style="font-size:13px;opacity:.9">Choose a profile picture (optional)</div>
          <input type="file" id="profilePicInput" accept="image/*">
        </div>
      </div>
      <div class="auth-actions">
        <button id="signUpBtn" class="rainbow">Sign Up</button>
        <button id="logInBtn">Log In</button>
      </div>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard">
    <div class="topbar">
      <div class="brand">‚ö° SkyNexaHost Dashboard</div>
      <div style="display:flex;align-items:center;gap:10px">
        <div class="profile-chip" id="openProfile">
          <div class="chip-avatar"><img id="chipAvatar" alt="avatar"></div>
          <div class="chip-name" id="chipName">User</div>
        </div>
        <button id="logoutBtn" title="Logout">Logout</button>
      </div>
    </div>
    <div class="dash-main">
      <button id="newProjectBtn" class="rainbow">+ New Project</button>
      <div id="projects"></div>
    </div>
  </div>

  <!-- WORKSPACE -->
  <div id="workspace">
    <div id="sidebar">
      <button id="addFileBtn" class="rainbow">+ Add File</button>
      <button id="searchUsersBtn" style="margin-top:10px" class="rainbow">üîç Search Users</button>
      <ul id="fileList"></ul>
    </div>
    <div id="editorArea">
      <div id="editorToolbar">
        <button id="saveBtn">Save</button>
        <button id="previewBtn" class="rainbow">Preview</button>
      </div>
      <div id="noFileMsg">Please add a file (e.g., <b>index.html</b>)</div>
      <div id="editor" style="width:100%;height:100%"></div>
    </div>
  </div>

  <!-- PREVIEW -->
  <div id="previewArea">
    <iframe id="previewFrame"></iframe>
    <button id="closePreviewBtn">Close</button>
  </div>

  <!-- PROFILE MODAL -->
  <div class="modal" id="profileModal">
    <div class="modal-card">
      <h3 style="margin:0 0 10px;color:var(--brand)">Profile</h3>
      <div class="row">
        <div class="field">
          <label style="font-size:13px;opacity:.8">Display Name</label>
          <input id="profileName" type="text" placeholder="Your name">
        </div>
        <div class="field">
          <label style="font-size:13px;opacity:.8">Change Avatar</label>
          <input id="profileAvatar" type="file" accept="image/*">
        </div>
      </div>
      <div style="margin-top:8px">
        <label style="font-size:13px;opacity:.8">Description</label>
        <textarea id="profileDesc" placeholder="About you..."></textarea>
      </div>
      <div class="modal-actions">
        <button id="closeProfile">Cancel</button>
        <button id="saveProfile" class="rainbow">Save</button>
      </div>
    </div>
  </div>

  <!-- SEARCH USERS MODAL -->
  <div class="modal" id="searchModal">
    <div class="modal-card">
      <h3 style="margin:0 0 10px;color:var(--brand)">Search Users</h3>
      <input type="text" id="searchInput" placeholder="Enter username..." 
             style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:#0f0f10;color:#fff">
      <div id="searchResult" style="margin-top:15px;min-height:60px"></div>
      <div class="modal-actions">
        <button id="closeSearch">Close</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.0/ace.js"></script>
  <script>
    let currentUser=null,currentProject=null,currentFile=null; 
    const editor=ace.edit('editor');
    editor.setTheme('ace/theme/monokai');
    editor.setValue('');

    function getUserKey(u){return 'user_'+u}
    function readUser(u){return JSON.parse(localStorage.getItem(getUserKey(u))||'null')}
    function writeUser(u,data){localStorage.setItem(getUserKey(u),JSON.stringify(data))}

    function makeDefaultAvatar(name='User'){
      const parts=name.trim().split(/\s+/).filter(Boolean);
      const initials=(parts[0]?.[0]||'U') + (parts[1]?.[0]||'');
      const cvs=document.createElement('canvas');cvs.width=256;cvs.height=256;const ctx=cvs.getContext('2d');
      const g=ctx.createLinearGradient(0,0,256,256);g.addColorStop(0,'#06beb6');g.addColorStop(1,'#48b1bf');
      ctx.fillStyle=g;ctx.fillRect(0,0,256,256);
      ctx.fillStyle='#fff';ctx.font='bold 120px Poppins, sans-serif';ctx.textAlign='center';ctx.textBaseline='middle';
      ctx.shadowColor='rgba(0,0,0,.25)';ctx.shadowBlur=12;ctx.fillText(initials.toUpperCase(),128,136);
      return cvs.toDataURL('image/png');
    }

    function setChipProfile(uData){
      const name=uData.profile?.name || currentUser;
      const avatar=uData.profile?.avatar || makeDefaultAvatar(name);
      document.getElementById('chipName').textContent=name;
      document.getElementById('chipAvatar').src=avatar;
    }

    window.onload=()=>{
      setTimeout(()=>{
        document.getElementById('loadingScreen').style.display='none';
        const u=localStorage.getItem('loggedIn');
        if(u){ currentUser=u;showDashboard(); }
        else{ document.getElementById('auth').style.display='flex'; }
      },4000);
    }

    const picInput=document.getElementById('profilePicInput');
    const authAvatarPreview=document.getElementById('authAvatarPreview');
    let tempAuthAvatar=null; 

    picInput?.addEventListener('change',()=>{
      const f=picInput.files?.[0];
      if(!f) return;
      const reader=new FileReader();
      reader.onload=e=>{
        tempAuthAvatar=e.target.result;
        authAvatarPreview.innerHTML='';
        const img=new Image();img.src=tempAuthAvatar;img.style.width='100%';img.style.height='100%';img.style.objectFit='cover';
        authAvatarPreview.appendChild(img);
      };
      reader.readAsDataURL(f);
    });

    function signUp(){
      const u=document.getElementById('username').value.trim();
      const p=document.getElementById('password').value.trim();
      if(!u||!p){alert('Enter username and password');return;}
      if(localStorage.getItem(getUserKey(u))){alert('User already exists');return;}
      const avatar=tempAuthAvatar || makeDefaultAvatar(u);
      const userData={password:p,projects:{},profile:{name:u,desc:'',avatar}};
      writeUser(u,userData);
      localStorage.setItem('loggedIn',u);
      currentUser=u;showDashboard();
    }

    function logIn(){
      const u=document.getElementById('username').value.trim();
      const p=document.getElementById('password').value.trim();
      const data=readUser(u);
      if(!data){alert('User not found');return;}
      if(data.password!==p){alert('Wrong password');return;}
      localStorage.setItem('loggedIn',u);
      currentUser=u;showDashboard();
    }

    function logout(){
      localStorage.removeItem('loggedIn');
      document.getElementById('dashboard').style.display='none';
      document.getElementById('workspace').style.display='none';
      document.getElementById('auth').style.display='flex';
    }

    function showDashboard(){
      document.getElementById('auth').style.display='none';
      document.getElementById('workspace').style.display='none';
      const dash=document.getElementById('dashboard');
      dash.style.display='block';
      const uData=readUser(currentUser);
      setChipProfile(uData);
      loadProjects();
    }

    function createProject(name){
      const uData=readUser(currentUser);
      if(uData.projects[name]){alert('Project already exists');return;}
      uData.projects[name]={};
      writeUser(currentUser,uData);
      loadProjects();
    }

    function loadProjects(){
      const uData=readUser(currentUser);
      const projectsDiv=document.getElementById('projects');
      projectsDiv.innerHTML='';
      for(const pname in uData.projects){
        const box=document.createElement('div');
        box.className='project-box';
        box.textContent=pname;
        box.onclick=()=>openProject(pname);
        projectsDiv.appendChild(box);
      }
    }

    function openProject(name){
      currentProject=name;
      document.getElementById('dashboard').style.display='none';
      document.getElementById('workspace').style.display='flex';
      loadFiles();
    }

    function loadFiles(){
      const uData=readUser(currentUser);
      const proj=uData.projects[currentProject];
      const ul=document.getElementById('fileList');ul.innerHTML='';
      for(const fname in proj){
        const li=document.createElement('li');li.textContent=fname;li.onclick=()=>openFile(fname);ul.appendChild(li);
      }
      document.getElementById('noFileMsg').style.display=Object.keys(proj).length? 'none':'flex';
      document.getElementById('editor').style.display=Object.keys(proj).length? 'block':'none';
    }

    function openFile(fname){
      currentFile=fname;
      const uData=readUser(currentUser);
      editor.setValue(uData.projects[currentProject][fname]||'',-1);
      document.getElementById('noFileMsg').style.display='none';
      document.getElementById('editor').style.display='block';
    }

    function saveFile(){
      if(!currentFile){alert('No file open');return;}
      const uData=readUser(currentUser);
      uData.projects[currentProject][currentFile]=editor.getValue();
      writeUser(currentUser,uData);
      alert('File saved');
    }

    function previewProject(){
      const uData=readUser(currentUser);
      const proj=uData.projects[currentProject];
      const frame=document.getElementById('previewFrame');
      let index=proj['index.html']||'<h1>No index.html found</h1>';
      const blob=new Blob([index],{type:'text/html'});
      frame.src=URL.createObjectURL(blob);
      document.getElementById('previewArea').style.display='block';
    }

    // Event Listeners
    document.getElementById('signUpBtn').onclick=signUp;
    document.getElementById('logInBtn').onclick=logIn;
    document.getElementById('logoutBtn').onclick=logout;
    document.getElementById('newProjectBtn').onclick=()=>{const name=prompt('Project name?');if(name)createProject(name)};
    document.getElementById('addFileBtn').onclick=()=>{const fname=prompt('File name? (e.g., index.html)');if(fname){const uData=readUser(currentUser);uData.projects[currentProject][fname]='';writeUser(currentUser,uData);loadFiles();}};
    document.getElementById('saveBtn').onclick=saveFile;
    document.getElementById('previewBtn').onclick=previewProject;
    document.getElementById('closePreviewBtn').onclick=()=>{document.getElementById('previewArea').style.display='none'};

    // Profile Modal
    const profileModal=document.getElementById('profileModal');
    document.getElementById('openProfile').onclick=()=>{
      const data=readUser(currentUser);
      document.getElementById('profileName').value=data.profile?.name||currentUser;
      document.getElementById('profileDesc').value=data.profile?.desc||'';
      profileModal.style.display='flex';
    }
    document.getElementById('closeProfile').onclick=()=>{profileModal.style.display='none'};
    document.getElementById('saveProfile').onclick=()=>{
      const data=readUser(currentUser);
      data.profile=data.profile||{};
      data.profile.name=document.getElementById('profileName').value||currentUser;
      data.profile.desc=document.getElementById('profileDesc').value||'';
      const f=document.getElementById('profileAvatar').files[0];
      if(f){
        const reader=new FileReader();
        reader.onload=e=>{
          data.profile.avatar=e.target.result;
          writeUser(currentUser,data);
          setChipProfile(data);
        };
        reader.readAsDataURL(f);
      }else{
        writeUser(currentUser,data);
        setChipProfile(data);
      }
      profileModal.style.display='none';
    }

    // === Search Users Modal Logic ===
    const searchModal=document.getElementById("searchModal");
    const searchUsersBtn=document.getElementById("searchUsersBtn");
    const closeSearch=document.getElementById("closeSearch");
    const searchInput=document.getElementById("searchInput");
    const searchResult=document.getElementById("searchResult");

    searchUsersBtn.onclick=()=>{searchInput.value="";searchResult.innerHTML="";searchModal.style.display="flex";}
    closeSearch.onclick=()=>{searchModal.style.display="none";}
    searchInput.onkeyup=()=>{
      const query=searchInput.value.trim().toLowerCase();
      if(!query){searchResult.innerHTML="<div style='opacity:.7'>Type a username...</div>";return;}
      let found=null;
      for(let i=0;i<localStorage.length;i++){
        const key=localStorage.key(i);
        if(key.startsWith("user_")){
          const uData=JSON.parse(localStorage.getItem(key));
          const uname=key.replace("user_","");
          if(uname.toLowerCase().includes(query)){found={uname,profile:uData.profile};break;}
        }
      }
      if(found){
        const avatar=found.profile?.avatar||makeDefaultAvatar(found.uname);
        searchResult.innerHTML=`
          <div style="display:flex;align-items:center;gap:12px;background:var(--glass);padding:12px;border-radius:12px;">
            <div style="width:50px;height:50px;flex:0 0 auto;border-radius:50%;overflow:hidden">
              <img src="${avatar}" style="width:100%;height:100%;object-fit:cover">
            </div>
            <div style="text-align:left">
              <div style="font-weight:600">${found.profile?.name||found.uname}</div>
              <div style="opacity:.8;font-size:13px">${found.profile?.desc||"No description"}</div>
            </div>
          </div>`;
      }else{
        searchResult.innerHTML="<div style='color:#f66'>No user found</div>";
      }
    }
  </script>
</body>
</html>



