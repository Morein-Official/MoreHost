<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MoreHost</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: Arial, sans-serif;
      background: black;
      color: white;
      overflow: hidden;
    }

    /* Loading screen */
    #loading {
      position: fixed;
      top:0; left:0;
      width:100%; height:100%;
      background:black;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      z-index: 2000;
    }
    #loading h1 {
      font-size:3rem;
      animation: float 3s infinite ease-in-out;
    }
    @keyframes float {
      0%,100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* Stars background */
    #stars {
      position: fixed;
      width:100%; height:100%;
      z-index:-1;
    }
    .star {
      position: absolute;
      width:2px; height:2px;
      background:white;
      border-radius:50%;
      animation: twinkle 3s infinite;
    }
    @keyframes twinkle {
      0%,100% { opacity:0.2; }
      50% { opacity:1; }
    }

    /* Auth */
    #authScreen {
      display:none;
      justify-content:center;
      align-items:center;
      height:100vh;
    }
    .auth-box {
      background:rgba(255,255,255,0.1);
      padding:2rem;
      border-radius:10px;
      text-align:center;
    }
    input {
      margin:10px 0;
      padding:10px;
      width:100%;
      border:none;
      border-radius:5px;
    }
    button {
      padding:10px 20px;
      margin-top:10px;
      border:none;
      border-radius:5px;
      cursor:pointer;
    }

    /* Dashboard */
    #dashboard {
      display:none;
      padding:2rem;
    }

    /* Workspace */
    #workspace {
      display:none;
      flex-direction:column;
      height:100vh;
    }
    #fileList button { margin:5px; }
    #editor {
      flex:1;
      font-family:monospace;
      font-size:14px;
      background:#111;
      color:#0f0;
      padding:10px;
      border:none;
      outline:none;
    }
    #preview {
      display:none;
      border:none;
    }
  </style>
</head>
<body>
  <!-- Loading -->
  <div id="loading">
    <h1>ðŸš€ MoreHost</h1>
    <p>Loading workspace...</p>
  </div>

  <!-- Stars -->
  <div id="stars"></div>

  <!-- Auth -->
  <div id="authScreen">
    <div class="auth-box">
      <h2>Sign Up</h2>
      <input id="username" placeholder="Enter name">
      <input id="password" type="password" placeholder="Enter password">
      <button onclick="signup()">Sign Up</button>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard">
    <h2>Welcome, <span id="userDisplay"></span></h2>
    <button onclick="newProject()">+ New Project</button>
    <button onclick="logout()">ðŸšª Logout</button>
    <h3>Your Projects</h3>
    <div id="projects"></div>
  </div>

  <!-- Workspace -->
  <div id="workspace">
    <div id="fileList">
      <button onclick="addFile()">+ Add File</button>
      <button onclick="saveProject()">ðŸ’¾ Save</button>
      <button onclick="showPreview()">â–¶ Preview</button>
      <button onclick="backToDashboard()">â¬… Dashboard</button>
    </div>
    <textarea id="editor"></textarea>
    <iframe id="preview"></iframe>
  </div>

  <script>
    let user = null;
    let projects = {};
    let currentProject = null;
    let currentFile = null;

    /* Loading */
    setTimeout(() => {
      document.getElementById("loading").style.display="none";
      const saved = localStorage.getItem("user");
      if (saved) {
        user = JSON.parse(saved);
        loadProjects();
        document.getElementById("dashboard").style.display="block";
        document.getElementById("userDisplay").innerText=user.name;
        renderProjects();
      } else {
        document.getElementById("authScreen").style.display="flex";
      }
    },2000);

    /* Stars */
    const stars=document.getElementById("stars");
    for (let i=0;i<100;i++){
      const s=document.createElement("div");
      s.className="star";
      s.style.top=Math.random()*100+"%";
      s.style.left=Math.random()*100+"%";
      s.style.animationDuration=(2+Math.random()*3)+"s";
      stars.appendChild(s);
    }

    /* Auth */
    function signup(){
      const name=document.getElementById("username").value;
      const pass=document.getElementById("password").value;
      if(!name||!pass) return alert("Fill all fields!");
      user={name,pass};
      localStorage.setItem("user",JSON.stringify(user));
      projects={};
      saveProjects();
      document.getElementById("authScreen").style.display="none";
      document.getElementById("dashboard").style.display="block";
      document.getElementById("userDisplay").innerText=user.name;
      renderProjects();
    }

    function logout(){
      user=null;
      localStorage.removeItem("user");
      projects={};
      document.getElementById("dashboard").style.display="none";
      document.getElementById("authScreen").style.display="flex";
    }

    /* Projects */
    function key(){ return "projects_"+user.name; }
    function saveProjects(){ localStorage.setItem(key(),JSON.stringify(projects)); }
    function loadProjects(){ projects=JSON.parse(localStorage.getItem(key())||"{}"); }

    function renderProjects(){
      const div=document.getElementById("projects");
      div.innerHTML="";
      for(let p in projects){
        const btn=document.createElement("button");
        btn.innerText=p;
        btn.onclick=()=>openProject(p);
        div.appendChild(btn);
      }
    }

    function newProject(){
      const name=prompt("Enter project name (no spaces):");
      if(!name) return;
      const safe=name.replace(/\s+/g,"_");
      projects[safe]={files:{}};
      saveProjects();
      openProject(safe);
    }

    function openProject(name){
      currentProject=projects[name];
      document.getElementById("dashboard").style.display="none";
      document.getElementById("workspace").style.display="flex";
      renderFiles();
    }

    function backToDashboard(){
      document.getElementById("workspace").style.display="none";
      document.getElementById("dashboard").style.display="block";
      saveProjects();
      renderProjects();
    }

    function addFile(){
      const fname=prompt("File name:");
      if(!fname) return;
      currentProject.files[fname]="";
      renderFiles();
      openFile(fname);
    }

    function renderFiles(){
      const div=document.getElementById("fileList");
      div.innerHTML=`
        <button onclick="addFile()">+ Add File</button>
        <button onclick="saveProject()">ðŸ’¾ Save</button>
        <button onclick="showPreview()">â–¶ Preview</button>
        <button onclick="backToDashboard()">â¬… Dashboard</button>
      `;
      for(let f in currentProject.files){
        const btn=document.createElement("button");
        btn.innerText=f;
        btn.onclick=()=>openFile(f);
        div.appendChild(btn);
      }
    }

    function openFile(fname){
      currentFile=fname;
      document.getElementById("editor").value=currentProject.files[fname];
    }

    function saveProject(){
      if(currentFile){
        currentProject.files[currentFile]=document.getElementById("editor").value;
        saveProjects();
        alert("Project saved!");
      }
    }

    /* Preview fix */
    function showPreview(){
      if(!currentFile) return alert("Open a file first!");
      saveProject();
      let code=currentProject.files[currentFile];
      if(!code.includes("<html")){
        code=`
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset='UTF-8'>
            <meta name='viewport' content='width=device-width, initial-scale=1.0'>
            <title>Preview</title>
            <style>body{background:white;color:black;}</style>
          </head>
          <body>${code}</body>
          </html>
        `;
      }
      const iframe=document.getElementById("preview");
      iframe.style.display="block";
      iframe.style.position="fixed";
      iframe.style.top="0"; iframe.style.left="0";
      iframe.style.width="100%"; iframe.style.height="100%";
      iframe.style.zIndex="9999";
      iframe.srcdoc=code;

      if(!document.getElementById("closePreview")){
        const btn=document.createElement("button");
        btn.id="closePreview";
        btn.innerText="âœ– Close Preview";
        btn.style.position="fixed";
        btn.style.top="20px"; btn.style.right="20px";
        btn.style.zIndex="10000";
        btn.style.background="#ff4444";
        btn.style.color="#fff";
        btn.style.padding="10px 20px";
        btn.style.border="none";
        btn.style.borderRadius="8px";
        btn.onclick=()=>{
          iframe.style.display="none";
          iframe.srcdoc="";
          btn.remove();
        };
        document.body.appendChild(btn);
      }
    }
  </script>
</body>
</html>
