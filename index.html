<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MoreHost</title>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Monaco -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>

  <style>
    html, body { height: 100%; background:#000; color:#fff; }
    /* Space stars background */
    .stars, .stars:after {
      content:"";
      position:fixed; inset:0;
      background: transparent;
      box-shadow:
        100px 200px #fff, 500px 300px #fff, 800px 1200px #fff,
        1500px 700px #fff, 2000px 900px #fff, 2500px 1100px #fff,
        300px 1500px #fff, 1200px 1800px #fff, 600px 400px #fff,
        900px 1000px #fff, 1800px 300px #fff, 2200px 1300px #fff;
      animation: fall 60s linear infinite;
      z-index:-1;
    }
    .stars:after { top:2000px; }
    @keyframes fall { from{ transform:translateY(0);} to{ transform:translateY(-2000px);} }

    /* Loading screen with floating letters */
    #loading {
      position:fixed; inset:0; display:flex; flex-direction:column;
      align-items:center; justify-content:center; background:#000; z-index:9999;
    }
    .loading-text { display:flex; gap:.25rem; font-size:3rem; font-weight:800; color:#00e5ff;
      text-shadow:0 0 10px #00e5ff, 0 0 20px #00e5ff, 0 0 40px #00e5ff; }
    .loading-text span { display:inline-block; animation: float 2s ease-in-out infinite; }
    .loading-text span:nth-child(1){animation-delay:0s}
    .loading-text span:nth-child(2){animation-delay:.15s}
    .loading-text span:nth-child(3){animation-delay:.3s}
    .loading-text span:nth-child(4){animation-delay:.45s}
    .loading-text span:nth-child(5){animation-delay:.6s}
    .loading-text span:nth-child(6){animation-delay:.75s}
    .loading-text span:nth-child(7){animation-delay:.9s}
    .loading-text span:nth-child(8){animation-delay:1.05s}
    @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-12px)} }

    /* Layout helpers */
    .glass { background: rgba(255,255,255,0.06); backdrop-filter: blur(8px); }
    .btn { @apply px-3 py-2 rounded-lg font-medium; }
    .btn-primary { @apply bg-cyan-500 text-black hover:bg-cyan-400; }
    .btn-ghost { @apply bg-white/10 hover:bg-white/20; }
    .divider { @apply h-px bg-white/10 my-4; }

    /* Monaco container */
    #editor { width:100%; height:100%; }

    /* Preview */
    #previewFrame { display:none; position:fixed; inset:0; width:100%; height:100%; border:0; z-index:9998; }
    #closePreviewBtn {
      display:none; position:fixed; top:16px; right:16px; z-index:9999;
      background:#ef4444; color:#fff; border:0; padding:10px 16px; border-radius:10px; cursor:pointer;
      box-shadow:0 8px 30px rgba(0,0,0,.5);
    }
  </style>
</head>
<body class="select-none">
  <div class="stars"></div>

  <!-- Loading -->
  <div id="loading">
    <div class="loading-text">
      <span>M</span><span>o</span><span>r</span><span>e</span><span>H</span><span>o</span><span>s</span><span>t</span>
    </div>
    <p class="text-white/70 mt-3">Preparing your workspaceâ€¦</p>
  </div>

  <!-- Top Navbar (visible in app screens) -->
  <header id="navbar" class="hidden fixed top-0 inset-x-0 h-14 glass border-b border-white/10 flex items-center justify-between px-4">
    <div class="flex items-center gap-3">
      <div class="w-8 h-8 rounded-full bg-cyan-400 ring-2 ring-cyan-300"></div>
      <span class="font-bold tracking-wide">MoreHost</span>
      <span class="text-white/40 text-sm">â€” Space for your code</span>
    </div>
    <div class="flex items-center gap-2">
      <button id="logoutBtn" class="btn btn-ghost">Logout</button>
    </div>
  </header>

  <!-- Auth Screen -->
  <main id="auth" class="hidden min-h-screen flex items-center justify-center px-4">
    <div class="glass border border-white/10 rounded-2xl p-8 w-full max-w-md shadow-2xl">
      <h2 class="text-3xl font-extrabold mb-6 text-center">Create your account</h2>
      <div class="space-y-3">
        <input id="authName" class="w-full bg-white/10 focus:bg-white/15 border border-white/10 rounded-lg px-4 py-3 outline-none" placeholder="Enter name"/>
        <input id="authPass" type="password" class="w-full bg-white/10 focus:bg-white/15 border border-white/10 rounded-lg px-4 py-3 outline-none" placeholder="Enter password"/>
        <button id="authBtn" class="btn btn-primary w-full">Sign Up</button>
      </div>
    </div>
  </main>

  <!-- Dashboard -->
  <section id="dashboard" class="hidden pt-16 px-4 pb-6">
    <div class="max-w-6xl mx-auto">
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-2xl font-bold">Dashboard</h1>
        <div class="flex items-center gap-2">
          <button id="newProjectBtn" class="btn btn-primary">+ New Project</button>
        </div>
      </div>
      <div class="divider"></div>
      <div id="projectsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </div>
  </section>

  <!-- Workspace -->
  <section id="workspace" class="hidden pt-16 h-[calc(100vh-56px)]">
    <div class="h-full grid grid-cols-[260px_1fr]">
      <!-- Sidebar (files) -->
      <aside class="glass border-r border-white/10 p-3 overflow-y-auto">
        <div class="flex items-center justify-between mb-2">
          <h3 class="font-semibold">Files</h3>
          <button id="addFileBtn" class="btn btn-ghost text-sm">+ Add</button>
        </div>
        <div id="filesList" class="space-y-1"></div>
        <div class="divider"></div>
        <div class="grid grid-cols-2 gap-2">
          <button id="saveBtn" class="btn btn-ghost">ðŸ’¾ Save</button>
          <button id="previewBtn" class="btn btn-primary">â–¶ Preview</button>
          <button id="backBtn" class="btn btn-ghost col-span-2">â¬… Back</button>
        </div>
      </aside>

      <!-- Editor area -->
      <div class="relative">
        <div class="absolute inset-0" id="editor"></div>
      </div>
    </div>
  </section>

  <!-- Preview Overlay -->
  <iframe id="previewFrame"></iframe>
  <button id="closePreviewBtn">âœ– Close Preview</button>

  <script>
    /* ====== State ====== */
    let user = null;
    let projects = {};
    let currentProjectName = null;
    let currentFile = null;
    let editor = null;

    const $ = (id) => document.getElementById(id);

    /* ====== UI Switchers ====== */
    function show(elId){ $(elId).classList.remove('hidden'); }
    function hide(elId){ $(elId).classList.add('hidden'); }

    /* ====== Storage keys (per-user) ====== */
    const userKey = () => "user";
    const projKey = () => user ? ("projects_" + user.name) : "projects_guest";

    function saveProjects(){ localStorage.setItem(projKey(), JSON.stringify(projects)); }
    function loadProjects(){ projects = JSON.parse(localStorage.getItem(projKey()) || "{}"); }

    /* ====== Loading -> App boot ====== */
    setTimeout(() => {
      hide('loading');
      show('navbar');

      const u = localStorage.getItem(userKey());
      if (u) {
        user = JSON.parse(u);
        $('logoutBtn').onclick = logout;
        loadProjects();
        renderDashboard();
        show('dashboard');
      } else {
        $('logoutBtn').onclick = logout;
        show('auth');
      }
    }, 1600); // smooth but not stuck

    /* ====== Auth ====== */
    $('authBtn').onclick = () => {
      const name = $('authName').value.trim();
      const pass = $('authPass').value.trim();
      if (!name || !pass) return alert('Fill all fields!');
      user = { name, pass };
      localStorage.setItem(userKey(), JSON.stringify(user));
      loadProjects(); // empty per new user
      hide('auth');
      renderDashboard();
      show('dashboard');
    };

    function logout(){
      localStorage.removeItem(userKey());
      user = null;
      projects = {};
      currentProjectName = null;
      currentFile = null;
      hide('workspace');
      hide('dashboard');
      show('auth');
    }

    /* ====== Dashboard ====== */
    $('newProjectBtn').onclick = () => {
      const name = prompt("Enter project name (no spaces):");
      if (!name) return;
      if (/\s/.test(name)) return alert("No spaces allowed. Use '-' or '_'.");
      loadProjects();
      if (projects[name]) return alert('Project already exists!');
      projects[name] = { files: {} };
      saveProjects();
      openWorkspace(name); // auto open
    };

    function renderDashboard(){
      loadProjects();
      const grid = $('projectsGrid');
      grid.innerHTML = "";
      Object.keys(projects).forEach(p => {
        const card = document.createElement('div');
        card.className = "glass border border-white/10 rounded-xl p-4 hover:bg-white/10 transition cursor-pointer";
        card.innerHTML = `
          <div class="flex items-center justify-between">
            <h3 class="font-bold">${p}</h3>
            <span class="text-xs text-white/50">click to open</span>
          </div>
        `;
        card.onclick = () => openWorkspace(p);
        grid.appendChild(card);
      });
    }

    /* ====== Workspace / Files ====== */
    function openWorkspace(name){
      currentProjectName = name;
      loadProjects();
      if (!projects[name]) { alert('Project not found'); return; }
      hide('dashboard');
      show('workspace');
      renderFiles();
      ensureEditor(() => {
        // If any file exists, open first automatically
        const files = Object.keys(projects[currentProjectName].files);
        if (files.length) openFile(files[0]);
        else editor.setValue("<!-- Start coding here (e.g., index.html) -->");
      });
    }

    function renderFiles(){
      const list = $('filesList');
      list.innerHTML = "";
      const files = projects[currentProjectName]?.files || {};
      Object.keys(files).forEach(fname => {
        const item = document.createElement('button');
        item.className = "w-full text-left btn btn-ghost";
        item.textContent = fname;
        item.onclick = () => openFile(fname);
        list.appendChild(item);
      });
    }

    $('addFileBtn').onclick = () => {
      const fname = prompt("File name (e.g. index.html):");
      if (!fname) return;
      loadProjects();
      const proj = projects[currentProjectName];
      if (!proj.files) proj.files = {};
      if (proj.files[fname]) return alert("File already exists!");
      proj.files[fname] = "";
      saveProjects();
      renderFiles();
      openFile(fname); // auto open new file
    };

    function openFile(fname){
      currentFile = fname;
      const content = projects[currentProjectName].files[fname] ?? "";
      if (editor) editor.setValue(content);
      else $('editor').textContent = content;
    }

    $('backBtn').onclick = () => {
      hide('workspace');
      renderDashboard();
      show('dashboard');
      currentFile = null;
    };

    $('saveBtn').onclick = () => saveProject();

    function saveProject(){
      if (!currentProjectName) return;
      if (currentFile && editor) {
        projects[currentProjectName].files[currentFile] = editor.getValue();
      }
      saveProjects();
      alert("Project Saved âœ…");
    }

    /* ====== Monaco ====== */
    function ensureEditor(cb){
      if (editor) { cb && cb(); return; }
      require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' }});
      require(['vs/editor/editor.main'], function() {
        editor = monaco.editor.create($('editor'), {
          value: "<!-- Start coding here (create a file from left + open it) -->",
          language: "html",
          theme: "vs-dark",
          automaticLayout: true,
          minimap: { enabled: false },
        });
        cb && cb();
      });
    }

    /* ====== Preview (pure sandbox + white fallback bg) ====== */
    $('previewBtn').onclick = () => {
      if (!currentProjectName || !currentFile) return alert("Open a file first!");
      saveProject(); // persist latest
      const codeRaw = projects[currentProjectName].files[currentFile] || "";
      let code = codeRaw;

      // If user didn't include full HTML, wrap with minimal doc + white bg
      if (!codeRaw.toLowerCase().includes("<html")) {
        code = `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Preview</title>
  <style>body{background:#ffffff;color:#111;margin:0;padding:16px;font-family:Arial, sans-serif;}</style>
</head>
<body>
  ${codeRaw}
</body>
</html>`;
      }

      const iframe = $('previewFrame');
      iframe.srcdoc = code;
      iframe.style.display = 'block';
      const closeBtn = $('closePreviewBtn');
      closeBtn.style.display = 'inline-block';
      closeBtn.onclick = () => {
        iframe.style.display = 'none';
        iframe.srcdoc = '';
        closeBtn.style.display = 'none';
      };
    };

    /* ====== Navbar actions ====== */
    $('logoutBtn').onclick = logout;
  </script>
</body>
</html>
